#!/bin/bash

# Скрипт для тестирования влияния параметра temperature на ответы Claude

API_URL="http://localhost:8080/api/chat"
MESSAGE="Напиши короткое стихотворение про кота (максимум 4 строки)"

echo "======================================"
echo "Тестирование влияния temperature на ответы Claude"
echo "======================================"
echo ""
echo "Вопрос: $MESSAGE"
echo ""

# Тест с низкой температурой (0.0 - более предсказуемый)
echo "======================================"
echo "1. НИЗКАЯ ТЕМПЕРАТУРА (0.0) - Предсказуемый, консервативный ответ"
echo "======================================"
curl -X POST "$API_URL" \
  -H "Content-Type: application/json" \
  -d "{\"message\":\"$MESSAGE\",\"temperature\":0.0,\"systemPrompt\":\"Отвечай обычным текстом, без JSON.\"}" \
  -s | jq -r '.response' | head -20
echo ""
echo ""

# Небольшая пауза между запросами
sleep 2

# Тест со средней температурой (0.5)
echo "======================================"
echo "2. СРЕДНЯЯ ТЕМПЕРАТУРА (0.5) - Сбалансированный ответ"
echo "======================================"
curl -X POST "$API_URL" \
  -H "Content-Type: application/json" \
  -d "{\"message\":\"$MESSAGE\",\"temperature\":0.5,\"systemPrompt\":\"Отвечай обычным текстом, без JSON.\"}" \
  -s | jq -r '.response' | head -20
echo ""
echo ""

sleep 2

# Тест с высокой температурой (1.0 - более креативный)
echo "======================================"
echo "3. ВЫСОКАЯ ТЕМПЕРАТУРА (1.0) - Креативный, разнообразный ответ"
echo "======================================"
curl -X POST "$API_URL" \
  -H "Content-Type: application/json" \
  -d "{\"message\":\"$MESSAGE\",\"temperature\":1.0,\"systemPrompt\":\"Отвечай обычным текстом, без JSON.\"}" \
  -s | jq -r '.response' | head -20
echo ""
echo ""

echo "======================================"
echo "Тест завершен!"
echo "======================================"
echo ""
echo "Ожидаемое поведение:"
echo "- Temperature 0.0: Более стабильные, похожие ответы при повторении"
echo "- Temperature 0.5: Умеренное разнообразие"
echo "- Temperature 1.0: Максимальное разнообразие и креативность"
echo ""
echo "Проверьте логи сервера, чтобы увидеть фактические значения temperature!"
